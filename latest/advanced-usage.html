<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Advanced usage - leptos-fluent</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Internationalization framework for Leptos using Fluent.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="./mdbook-admonish.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">leptos-fluent</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/mondeja/leptos-fluent/tree/master/book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/mondeja/leptos-fluent/edit/master/book/src/advanced-usage.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="advanced-usage"><a class="header" href="#advanced-usage">Advanced usage</a></h1>
<ul>
<li><a href="#tr-and-move_tr-outside-reactive-graph"><code>tr!</code> and <code>move_tr!</code> outside reactive graph</a>
<ul>
<li><a href="#the-problem">The problem</a></li>
<li><a href="#on-events-panics">On events, panics</a></li>
</ul>
</li>
<li><a href="#dynamic-text-identifiers-for-tr-and-move_tr">Dynamic text identifiers for <code>tr!</code> and <code>move_tr!</code></a>
<ul>
<li><a href="#dynamic-compile-time-checking">Dynamic compile time checking</a>
<ul>
<li><a href="#if-else-if-else"><code>if (else if)? else</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#configuration-conditional-checks">Configuration conditional checks</a></li>
<li><a href="#destructuring-leptos_fluent-parameters">Destructuring <code>leptos_fluent!</code> parameters</a></li>
</ul>
<h2 id="tr-and-move_tr-outside-reactive-graph"><a class="header" href="#tr-and-move_tr-outside-reactive-graph"><code>tr!</code> and <code>move_tr!</code> outside reactive graph</a></h2>
<p>This section of the documentation only applies to Leptos &gt;= v0.7 and &lt;= 0.8.8.
If you're using Leptos &gt;= v0.8.9, you can ignore it.</p>
<p>Leptos v0.8.9 introduced owner preservation in actions and event listeners
as intended behaviour for first time in <a href="https://github.com/leptos-rs/leptos/pull/4267">leptos#4267</a>.</p>
<h3 id="the-problem"><a class="header" href="#the-problem">The problem</a></h3>
<p>Outside the reactive ownership tree, mainly known as the <em>reactive graph</em>,
we can't obtain the context of <code>I18n</code> using <code>expect_context::&lt;leptos_fluent::I18n&gt;()</code>,
which is what <code>tr!</code> and <code>move_tr!</code> do internally. Instead, pass the context
as first parameter to the macros:</p>
<pre><code class="language-rust">use leptos::prelude::expect_context;
use leptos_fluent::{I18n, move_tr};

let i18n = expect_context::&lt;I18n&gt;();
let translated_signal = move_tr!(i18n, "my-translation");</code></pre>
<h3 id="on-events-panics"><a class="header" href="#on-events-panics">On events, panics</a></h3>
<p>For example, the next code panics when the <code>&lt;div&gt;</code> container is clicked:</p>
<pre><code class="language-rust">use leptos::prelude::*;
use leptos_fluent::tr;

#[component]
pub fn App() -&gt; impl IntoView {
    view! {
        &lt;Show when=|| true&gt;
            &lt;Child/&gt;
        &lt;/Show&gt;
    }
}

#[component]
pub fn Child() -&gt; impl IntoView {
    view! {
        &lt;div on:click=|_| {
            tr!("my-translation");
        }&gt;"CLICK ME!"&lt;/div&gt;
    }
}</code></pre>
<p>With Leptos v0.7, whatever <code>tr!</code> macro used in the <code>on:</code> event will panic,
but with Leptos v0.6, this outsiding of the ownership tree has been ignored
in almost all cases as unintended behavior.</p>
<p>To avoid that, pass the i18n context as first parameter to <code>tr!</code> and <code>move_tr!</code>:</p>
<pre><code class="language-rust">use leptos::prelude::*;
use leptos_fluent::{I18n, tr};

#[component]
pub fn App() -&gt; impl IntoView {
    view! {
        &lt;Show when=|| true&gt;
            &lt;Child/&gt;
        &lt;/Show&gt;
    }
}

#[component]
pub fn Child() -&gt; impl IntoView {
    let i18n = expect_context::&lt;I18n&gt;();
    view! {
        &lt;div on:click=|_| {
            tr!(i18n, "my-translation");
        }&gt;"CLICK ME!"&lt;/div&gt;
    }
}</code></pre>
<h2 id="dynamic-text-identifiers-for-tr-and-move_tr"><a class="header" href="#dynamic-text-identifiers-for-tr-and-move_tr">Dynamic text identifiers for <code>tr!</code> and <code>move_tr!</code></a></h2>
<p>Dynamic translations keys can't be passed to <code>tr!</code> and <code>move_tr!</code> macros through
variables as is because they will not be checkable at compile time
by <code>check_translations</code> option of <code>leptos_fluent!</code> macro.</p>
<pre><code class="language-rust">use leptos_fluent::tr;

// not allowed
let text_id = "my-translation";
tr!(text_id);
/*
error: argument must be a string literal
  --&gt; src/lib.rs
   |
   |     tr!(text_id);
   |     ^^^^^^^^^^^^
*/</code></pre>
<p>Instead, you can use the methods <code>i18n.tr</code> and <code>i18n.tr_with_args</code>:</p>
<pre><code class="language-rust">use leptos::prelude::expect_context;
use leptos_fluent::I18n;

let text_id = "my-translation";
let i18n = expect_context::&lt;I18n&gt;();
i18n.tr(text_id);</code></pre>
<pre><code class="language-rust">use std::collections::HashMap;
use leptos::prelude::expect_context;
use leptos_fluent::I18n;

let text_id = "hello-args";
let mut args = HashMap::new();
args.insert("name", "World");

let i18n = expect_context::&lt;I18n&gt;();
i18n.tr_with_args(text_id, args);</code></pre>
<p>Note that <code>i18n.tr</code> and <code>i18n.tr_with_args</code> methods are not reactive,
so you need to enclose their calls in a reactive context like a function to
update the view on the fly when the language changes, and that the translations
checker will not be able to check passed translation data at compile time,
even if they're defined as literals.</p>
<h3 id="dynamic-compile-time-checking"><a class="header" href="#dynamic-compile-time-checking">Dynamic compile time checking</a></h3>
<p>If you want dynamic translations keys to be checked at compile time with the
<code>check_translations</code> option of <code>leptos_fluent!</code> macro, you must give some
information about the keys you're using leptos-fluent.</p>
<p>Currently, the next patterns are supported:</p>
<h4 id="if-else-if-else"><a class="header" href="#if-else-if-else"><code>if (else if)? else</code></a></h4>
<pre><code class="language-rust">use leptos_fluent::{tr, move_tr};

let (foo, bar) = (false, true);

tr!(if foo {"foo"} else {"bar"});
move_tr!(if foo {"foo"} else if bar {"bar"} else {"baz"});</code></pre>
<p>Of course, other associated variants are supported:</p>
<pre><code class="language-rust">// stable
#[allow(unused_parens)]
_ = tr!(
    i18n,
    if (my_signal.get() &amp;&amp; my_function()) {"foo"} else {"bar"},
    {
        "arg1" =&gt; "value1",
        "arg2" =&gt; "value2",
    }
);

// nightly
#![feature(stmt_expr_attributes)]

_ = move_tr!(
    i18n,
    #[allow(unused_parens)]
    if (my_signal.get() &amp;&amp; my_function()) {"foo"} else {"bar"},
    #[allow(unused_braces)]
    {
        "arg1" =&gt; "value1",
        "arg2" =&gt; {"value2"},
    }
);</code></pre>
<h2 id="configuration-conditional-checks"><a class="header" href="#configuration-conditional-checks">Configuration conditional checks</a></h2>
<p>You can pass <a href="https://doc.rust-lang.org/rust-by-example/attribute/cfg.html">configuration conditional checks</a> to most parameters of the
<code>leptos_fluent!</code> macro. For example, you can set the <code>set_language_to_url_param</code>
parameter to <code>true</code> in debug mode and to <code>false</code> in release mode:</p>
<pre><code class="language-rust">leptos_fluent! {
    // ...
    #[cfg(debug_assertions)]
    set_language_to_url_param: true,
    #[cfg(not(debug_assertions))]
    set_language_to_url_param: false,
}</code></pre>
<p>Options that use compile-time execution, like <code>check_translations</code>,
only accept assertions that are known at compile time for leptos-fluent.</p>
<h2 id="destructuring-leptos_fluent-parameters"><a class="header" href="#destructuring-leptos_fluent-parameters">Destructuring <code>leptos_fluent!</code> parameters</a></h2>
<p>You can destructure the runtime parameters of the <code>leptos_fluent!</code> macro to make
the code more readable. Instead of:</p>
<pre><code class="language-rust">let my_cookie_name = "language";
leptos_fluent! {
    // ...
    cookie_name: my_cookie_name,
}</code></pre>
<p>You can destructure the parameter <code>cookie_name</code>:</p>
<pre><code class="language-rust">let cookie_name = "language";
leptos_fluent! {
    // ...
    cookie_name,  // `cookie_name: cookie_name`
}</code></pre>
<p>Ideal for passing props to the internationalization provider component:</p>
<pre><code class="language-rust">#[component]
pub fn I18n(children: Children, cookie_name: &amp;str) -&gt; impl IntoView {
    leptos_fluent! {
        children: children(),
        // ...
        cookie_name,
    }
}

#[component]
pub fn App() -&gt; impl IntoView {
    view! {
        &lt;I18n cookie_name="language"&gt;
            // ...
        &lt;/I18n&gt;
    }
}</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="checking-translations.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="faqs.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="checking-translations.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="faqs.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="ace.js"></script>
        <script src="mode-rust.js"></script>
        <script src="editor.js"></script>
        <script src="theme-dawn.js"></script>
        <script src="theme-tomorrow_night.js"></script>

        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
