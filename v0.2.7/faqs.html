<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>FAQs - leptos-fluent</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Internationalization framework for Leptos using Fluent.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="./mdbook-admonish.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">leptos-fluent</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/mondeja/leptos-fluent/tree/master/book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/mondeja/leptos-fluent/edit/master/book/src/faqs.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!-- markdownlint-disable MD001 -->
<h1 id="faqs"><a class="header" href="#faqs">FAQs</a></h1>
<ul>
<li><a href="#how-to-get-languageidentifier">How to get <code>LanguageIdentifier</code>?</a></li>
<li><a href="#custom-cookie-attributes-are-invalid">Custom cookie attributes are invalid</a></li>
<li><a href="#how-to-get-the-fallback-language">How to get the fallback language</a></li>
<li><a href="#dynamic-translations-keys">Dynamic translations keys</a></li>
<li><a href="#tr-and-move_tr-outside-reactive-graph"><code>tr!</code> and <code>move_tr!</code> outside reactive graph</a>
<ul>
<li><a href="#on-events-panics">On events, panics</a></li>
</ul>
</li>
<li><a href="#why-examples-dont-use-for-component">Why examples don't use <code>&lt;For/&gt;</code> component?</a></li>
<li><a href="#how-to-manage-translations-on-server-actions">How to manage translations on server actions</a></li>
<li><a href="#how-to-get-values-of-leptos_fluent-macro-at-runtime">How to get values of <code>leptos_fluent!</code> macro at runtime?</a></li>
<li><a href="#configuration-conditional-checks">Configuration conditional checks</a></li>
</ul>
<h3 id="how-to-get-languageidentifier"><a class="header" href="#how-to-get-languageidentifier">How to get <a href="https://docs.rs/unic-langid/latest/unic_langid/struct.LanguageIdentifier.html"><code>LanguageIdentifier</code></a>?</a></h3>
<pre><code class="language-rust">use fluent_templates::LanguageIdentifier;</code></pre>
<div id="admonition-tip" class="admonition admonish-tip" role="note" aria-labelledby="admonition-tip-title">
<div class="admonition-title">
<div id="admonition-tip-title">
<p>Tip</p>
</div>
<a class="admonition-anchor-link" href="#admonition-tip"></a>
</div>
<div>
<p><code>fluent-templates</code> also depends externally on
<a href="https://docs.rs/fluent-bundle/latest/fluent_bundle/"><code>fluent-bundle</code></a>
whichs provides utilities for parsing the Fluent syntax.</p>
</div>
</div>
<h3 id="custom-cookie-attributes-are-invalid"><a class="header" href="#custom-cookie-attributes-are-invalid">Custom <a href="https://developer.mozilla.org/docs/Web/API/Document/cookie#write_a_new_cookie">cookie attributes</a> are invalid</a></h3>
<p>Use an expression to set the cookie attributes and will not be validated.</p>
<pre><code class="language-rust">let attrs = "SameSite=Strict; MyCustomAttr=MyCustomValue;";
leptos_fluent! {
    cookie_attrs: attrs,
    // ...
};</code></pre>
<h3 id="how-to-get-the-fallback-language"><a class="header" href="#how-to-get-the-fallback-language">How to get the fallback language</a></h3>
<p>From fluent-templates <code>v0.10</code> onwards can be obtained from your translations.</p>
<pre><code class="language-rust">let fallback_language = expect_i18n().translations.get()[0].fallback();</code></pre>
<h3 id="dynamic-translations-keys"><a class="header" href="#dynamic-translations-keys">Dynamic translations keys</a></h3>
<p>Dynamic translations keys can't be passed to <code>tr!</code> and <code>move_tr!</code> macros because
variables will not be checkable at compile time by <code>check_translations</code> option
of <code>leptos_fluent!</code> macro.</p>
<pre><code class="language-rust">use leptos_fluent::tr;

// not allowed
let text_id = "my-translation";
tr!(text_id);</code></pre>
<p>Instead, use <code>tr_impl</code> and <code>tr_with_args_impl</code> functions:</p>
<pre><code class="language-rust">use leptos_fluent::{expect_i18n, tr_impl as tr};

let text_id = "my-translation";
tr(expect_i18n(), text_id);</code></pre>
<pre><code class="language-rust">use std::collections::HashMap;
use leptos_fluent::{expect_i18n, tr_with_args_impl as tr_with_args};

let text_id = "hello-args";
let mut args = HashMap::new();
args.insert("name", "World");
tr_with_args(expect_i18n(), text_id, args);</code></pre>
<p>Note that <code>tr_impl</code> and <code>tr_with_args_impl</code> functions are not reactive,
so you need to enclose their calls in a reactive context like a function to
update the view on the fly when the language changes, and that the translations
checker will not be able to check passed translation data at compile time,
even if they're defined as literals.</p>
<h3 id="tr-and-move_tr-outside-reactive-graph"><a class="header" href="#tr-and-move_tr-outside-reactive-graph"><code>tr!</code> and <code>move_tr!</code> outside reactive graph</a></h3>
<p>Outside the reactive ownership tree, mainly known as the <em>reactive graph</em>,
we can't obtain the context of <code>I18n</code> using <code>expect_context::&lt;leptos_fluent::I18n&gt;()</code>,
which is what <code>tr!</code> and <code>move_tr!</code> do internally. Instead, we can pass the context
as first parameter to the macros:</p>
<pre><code class="language-rust">let i18n = expect_i18n();

let translated_signal = move_tr!(i18n, "my-translation");</code></pre>
<p>And some shortcuts cannot be used. Rewrite all the code that calls <code>expect_context</code>
internally:</p>
<ul>
<li>Use <code>i18n.language.set(lang)</code> instead of <code>lang.activate()</code>.</li>
<li>Use <code>lang == i18n.language.get()</code> instead of <code>lang.is_active()</code>.</li>
</ul>
<h4 id="on-events-panics"><a class="header" href="#on-events-panics">On events, panics</a></h4>
<p>For example, the next code panics when the <code>&lt;div&gt;</code> container is clicked:</p>
<pre><code class="language-rust">#[component]
pub fn App() -&gt; impl IntoView {
    view! {
        &lt;Show when=|| true&gt;
            &lt;Child/&gt;
        &lt;/Show&gt;
    }
}

#[component]
pub fn Child() -&gt; impl IntoView {
    view! {
        &lt;div on:click=|_| {
            tr!("my-translation");
        }&gt;"CLICK ME!"&lt;/div&gt;
    }
}</code></pre>
<p>With Leptos v0.7, whatever <code>tr!</code> macro used in the <code>on:</code> event will panic,
but with Leptos v0.6, this outsiding of the ownership tree has been ignored
from the majority of the cases as unintended behavior.</p>
<p>To avoid that, pass the i18n context as first parameter to <code>tr!</code> or <code>move_tr!</code>:</p>
<pre><code class="language-rust">#[component]
pub fn App() -&gt; impl IntoView {
    view! {
        &lt;Show when=|| true&gt;
            &lt;Child/&gt;
        &lt;/Show&gt;
    }
}

#[component]
pub fn Child() -&gt; impl IntoView {
    let i18n = expect_i18n();
    view! {
        &lt;div on:click=|_| {
            tr!(i18n, "my-translation");
        }&gt;"CLICK ME!"&lt;/div&gt;
    }
}</code></pre>
<h3 id="why-examples-dont-use-for-component"><a class="header" href="#why-examples-dont-use-for-component">Why examples don't use <a href="https://docs.rs/leptos/latest/leptos/control_flow/fn.For.html"><code>&lt;For/&gt;</code></a> component?</a></h3>
<div id="admonition-bug" class="admonition admonish-bug" role="note" aria-labelledby="admonition-bug-title">
<div class="admonition-title">
<div id="admonition-bug-title">
<p>Bug</p>
</div>
<a class="admonition-anchor-link" href="#admonition-bug"></a>
</div>
<div>
<p>There are some cases in which the <a href="https://docs.rs/leptos/latest/leptos/control_flow/fn.For.html"><code>&lt;For/&gt;</code></a> component is not reproducible between
SSR and hydrate modes leading to different renders, so decided to use a
simple vector to not bring confusion to main examples.</p>
</div>
</div>
<p>In any case, the <a href="https://docs.rs/leptos/latest/leptos/control_flow/fn.For.html"><code>&lt;For/&gt;</code></a> component is safe on CSR contexts and
<a href="https://docs.rs/leptos-fluent/latest/leptos_fluent/struct.Language.html"><code>leptos_fluent::Language</code></a> implement <code>Hash</code> and <code>Eq</code> traits to be
able to be passed directly to <code>key</code>s properties trigerring reactivity
depending on the current active language.</p>
<pre><code class="language-rust">use leptos_fluent::{i18n, Language};

leptos::logging::warn!("[WARNING]: Not secure on SSR");
view! {
    &lt;p&gt;{move_tr!("select-a-language")}&lt;/p&gt;
    &lt;For
        each=move || i18n().languages
        key=|lang| *lang
        children=move |lang| render_language(lang)
    /&gt;
}

fn render_language(lang: &amp;'static Language) -&gt; impl IntoView { ... }</code></pre>
<h3 id="how-to-manage-translations-on-server-actions"><a class="header" href="#how-to-manage-translations-on-server-actions">How to manage translations on server actions</a></h3>
<p>The translations reside on the client side, so the <a href="https://docs.rs/leptos-fluent/latest/leptos_fluent/struct.I18n.html"><code>I18n</code></a> can not be
accessed as context on server actions. Pass the translations as values
if the bandwidth is not a problem or use your own statics on server side.</p>
<pre><code class="language-rust">use leptos::prelude::*;
use leptos_fluent::{tr, Language};

/// Server action showing client-side translated message on console
#[server(ShowHelloWorld, "/api")]
pub async fn show_hello_world(
    translated_hello_world: String,
    language: String,
) -&gt; Result&lt;(), ServerFnError&gt; {
    println!("{translated_hello_world} ({language})");
    Ok(())
}

fn render_language(lang: &amp;'static Language) -&gt; impl IntoView {
    let i18n = expect_i18n();

    // Call on click to server action with a client-side translated
    // "hello-world" message
    let on_click = move |_| {
        i18n.language.set(lang);
        spawn_local(async {
            _ = show_hello_world(
                tr!(i18n, "hello-world"),
                lang.name.to_string(),
            ).await;
        });
    };

    view! {
        &lt;div&gt;
            &lt;label for=lang&gt;{lang.name}&lt;/label&gt;
            &lt;input
                id=lang
                name="language"
                value=lang
                checked=lang.is_active()
                on:click=on_click
                type="radio"
            /&gt;
        &lt;/div&gt;
    }
}</code></pre>
<h3 id="how-to-get-values-of-leptos_fluent-macro-at-runtime"><a class="header" href="#how-to-get-values-of-leptos_fluent-macro-at-runtime">How to get values of <code>leptos_fluent!</code> macro at runtime?</a></h3>
<p>Use <code>provide_meta_context</code> at the macro initialization and get them
with the method <code>I18n::meta</code>:</p>
<pre><code class="language-rust">leptos_fluent! {
    // ...
    provide_meta_context: true,
};

// ... later
println!("Macro parameters: {:?}", expect_i18n().meta().unwrap());</code></pre>
<h3 id="configuration-conditional-checks"><a class="header" href="#configuration-conditional-checks"><a href="https://doc.rust-lang.org/rust-by-example/attribute/cfg.html">Configuration conditional checks</a></a></h3>
<pre><code class="language-rust">leptos_fluent! {
    // ...
    #[cfg(debug_assertions)]
    set_language_to_url_param: true,
    #[cfg(not(debug_assertions))]
    set_language_to_url_param: false,
}</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="checking-translations.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="leptos_fluent.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="checking-translations.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="leptos_fluent.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="ace.js"></script>
        <script src="editor.js"></script>
        <script src="mode-rust.js"></script>
        <script src="theme-dawn.js"></script>
        <script src="theme-tomorrow_night.js"></script>

        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
