# leptos-fluent

<!-- This file has been autogenerated.
To update it, change the content of `leptos-fluent/src/lib.rs`
and run `pre-commit run -a cargo-readme`
-->

[![Crates.io](https://img.shields.io/crates/v/leptos-fluent)](https://crates.io/crates/leptos-fluent)
[![License](https://img.shields.io/crates/l/leptos-fluent?logo=mit)](https://github.com/mondeja/leptos-fluent/blob/master/LICENSE.md)
[![Tests](https://img.shields.io/github/actions/workflow/status/mondeja/leptos-fluent/ci.yml?label=tests&logo=github)](https://github.com/mondeja/leptos-fluent/actions)
[![docs.rs](https://img.shields.io/docsrs/leptos-fluent?logo=docs.rs)][documentation]

Internationalization framework for [Leptos] using [fluent-templates].

## Installation

Add the following to your `Cargo.toml` file:

```toml
[dependencies]
leptos-fluent = "0.0.26"
fluent-templates = "0.9"

[features]
hydrate = [
  "leptos-fluent/hydrate"
]
ssr = [
  "leptos-fluent/ssr",
  "leptos-fluent/actix",  # actix and axum are supported
]
```

## Usage

Giving the following directory structure:

```plaintext
.
â”œâ”€â”€ ðŸ“„ Cargo.toml
â”œâ”€â”€ ðŸ“ locales
â”‚   â”œâ”€â”€ ðŸ“ en
â”‚   â”‚   â””â”€â”€ ðŸ“„ main.ftl
â”‚   â””â”€â”€ ðŸ“ es
â”‚       â””â”€â”€ ðŸ“„ main.ftl
â””â”€â”€ ðŸ“ src
    â”œâ”€â”€ ðŸ“„ main.rs
    â””â”€â”€ ðŸ“„ lib.rs
```

With Fluent files _en.ftl_ and _es.ftl_:

```ftl
hello-world = Hello, world!
hello-args = Hello, { $arg1 } and { $arg2 }!
```

```ftl
hello-world = Â¡Hola, mundo!
hello-args = Â¡Hola, { $arg1 } y { $arg2 }!
```

You can use `leptos-fluent` as follows:

```rust
use fluent_templates::static_loader;
use leptos::*;
use leptos_fluent::{expect_i18n, leptos_fluent, move_tr, tr, Language};

static_loader! {
    static TRANSLATIONS = {
        locales: "./locales",
        fallback_language: "en",
    };
}

#[component]
fn App() -> impl IntoView {
    leptos_fluent! {{
        // Path to the locales directory, relative to Cargo.toml file.
        locales: "./locales",
        // Static translations struct provided by fluent-templates.
        translations: TRANSLATIONS,

        // Client side options
        // -------------------
        // Synchronize `<html lang="...">` attribute with the current
        // language using `leptos::create_effect`. By default, it is `false`.
        sync_html_tag_lang: true,
        // URL parameter name to use discovering the initial language
        // of the user. By default is `"lang"`.
        url_param: "lang",
        // Discover the initial language of the user from the URL.
        // By default, it is `false`.
        initial_language_from_url_param: true,
        // Set the discovered initial language of the user from
        // the URL in local storage. By default, it is `false`.
        initial_language_from_url_param_to_localstorage: true,
        // Update the language on URL parameter when using the method
        // `I18n.set_language`. By default, it is `false`.
        set_language_to_url_param: true,
        // Name of the field in local storage to get and set the
        // current language of the user. By default, it is `"lang"`.
        localstorage_key: "language",
        // Get the initial language from local storage if not found
        // in an URL param. By default, it is `false`.
        initial_language_from_localstorage: true,
        // Update the language on local storage when using the method
        // `I18n.set_language`. By default, it is `false`.
        set_language_to_localstorage: true,
        // Get the initial language from `navigator.languages` if not
        // found in the local storage. By default, it is `false`.
        initial_language_from_navigator: true,

        // Server side options
        // -------------------
        // Set the initial language from the Accept-Language header of the
        // request. By default, it is `false`.
        initial_language_from_accept_language_header: true,
    }};

    view! {
        <ChildComponent />
        <LanguageSelector />
    }
}

#[component]
fn ChildComponent() -> impl IntoView {
    // Use `tr!` and `move_tr!` macros to translate strings:
    view! {
        <p>
            <span>{move || tr!("hello-world")}</span>
            <span>{move_tr!("hello-args", {
                "arg1" => "value1",
                "arg2" => "value2",
            })}</span>
        </p>
    }

    // You must use `tr!` inside a reactive context or the translation
    // will not be updated on the fly when the current language changes.
}

#[component]
fn LanguageSelector() -> impl IntoView {
    // Use `expect_i18n` to get the current i18n context:
    let i18n = expect_i18n();

    // `i18n.languages` is a static array with the available languages
    // `i18n.language` is a signal with the current language
    // `i18n.set_language(lang)` is a method to set the current language
    // `i18n.is_active_language(lang)` is a method to check if a language is active
    // `i18n.language_key(lang)` is a method to get a hash for a language

    view! {
        <fieldset>
            <For
                each=move || i18n.languages
                key=move |lang| i18n.language_key(lang)
                children=move |lang: &&Language| {
                    view! {
                        <div>
                            <input
                                type="radio"
                                id=lang.id.to_string()
                                name="language"
                                value=lang.id.to_string()
                                checked=i18n.is_active_language(lang)
                                on:click=move |_| i18n.set_language(lang)
                            />
                            <label for=lang.id.to_string()>{lang.name}</label>
                        </div>
                    }
                }
            />
        </fieldset>
    }
}
```

### Features

- **Server Side Rendering**: Use the `leptos-fluent/ssr` feature.
- **Hydration**: Use the `leptos-fluent/hydrate` feature.
- **Actix Web integration**: Use the `leptos-fluent/actix` feature.
- **Axum integration**: Use the `leptos-fluent/axum` feature.

## Resources

- [Quickstart]
- [Examples]
- [Documentation]

## Roadmap

Leptos-fluent is currently ready for most use cases. However, it is still in an
early stage of development and the API may contain breaking changes through
v0.0.X releases. I'm trying to release the API at v0.1.0 as stable as possible.

[leptos]: https://leptos.dev/
[fluent-templates]: https://github.com/XAMPPRocky/fluent-templates
[quickstart]: https://docs.rs/leptos-fluent/latest/leptos_fluent/macro.leptos_fluent.html
[examples]: https://github.com/mondeja/leptos-fluent/tree/master/examples
[documentation]: https://docs.rs/leptos-fluent
